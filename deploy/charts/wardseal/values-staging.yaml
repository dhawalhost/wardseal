# Staging Environment Values
# Override default values for staging deployment

global:
  imageRegistry: ghcr.io/dhawalhost

# Database - Staging
database:
  host: postgres-staging.wardseal.svc.cluster.local
  port: 5432
  name: identity_platform_staging
  sslMode: require
  existingSecret: wardseal-db-credentials-staging

# Auth Service - Staging
authsvc:
  enabled: true
  replicaCount: 1

  image:
    tag: "latest"  # Will be overridden by CI

  env:
    LOG_LEVEL: debug
    DIRECTORY_SERVICE_URL: http://wardseal-dirsvc:8081
    AUTH_SERVICE_URL: https://auth-staging.wardseal.com

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Directory Service - Staging
dirsvc:
  enabled: true
  replicaCount: 1

  image:
    tag: "latest"

  env:
    LOG_LEVEL: debug

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Governance Service - Staging
govsvc:
  enabled: true
  replicaCount: 1

  image:
    tag: "latest"

  env:
    LOG_LEVEL: debug
    DIRECTORY_SERVICE_URL: http://wardseal-dirsvc:8081

  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Ingress - Staging
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-staging
  hosts:
    - host: auth-staging.wardseal.com
      paths:
        - path: /
          pathType: Prefix
          service: authsvc
          port: 8080
    - host: api-staging.wardseal.com
      paths:
        - path: /api/v1/users
          pathType: Prefix
          service: dirsvc
          port: 8081
        - path: /api/v1/groups
          pathType: Prefix
          service: dirsvc
          port: 8081
        - path: /api/v1/oauth
          pathType: Prefix
          service: govsvc
          port: 8082
        - path: /api/v1/governance
          pathType: Prefix
          service: govsvc
          port: 8082
  tls:
    - secretName: wardseal-tls-staging
      hosts:
        - auth-staging.wardseal.com
        - api-staging.wardseal.com
